<div class="battle-container">
    <div class="battlefield">
        <div class="grid">
            <div class="row">
                <div class="cell label"></div>
                <div class="cell" *ngFor="let col of columnLabels">{{ col }}</div>
            </div>
            <div class="row" *ngFor="let row of grid; let r = index">
                <div class="cell label">{{ r + 1 }}</div>
                <div class="cell" *ngFor="let cell of row"
                    [ngClass]="cell.status === 'revealed-ship' || cell.status === 'revealed-carrier' ? 'on-fire ' : cell.status">
                    <i *ngIf="cell.status === 'revealed-ship' && cell.type != 'additional'"
                        class="fa-solid fa-ship"></i>
                    <img *ngIf="cell.status === 'revealed-ship' && cell.icon" [src]="cell.icon" [ngClass]="cell.icon"
                        width="24" height="24" />
                    <ng-container *ngIf="cell.status === 'hit-sunk'">
                        <i class="fa-solid fa-ship ship-silhouette" aria-hidden="true"></i>
                        <i class="fa-solid fa-skull-crossbones sunk-mark" aria-hidden="true"></i>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
    <div class="list-panel">
        <div class="highlight-label">
            {{nextMessage}}: <strong>{{ names[highlightedIndex] }}</strong>
        </div>
        <div cdkDropList [cdkDropListDisabled]="locked">
            <mat-card *ngFor="let name of names; index as i" cdkDrag class="name-card" [class.locked]="locked"
                [class.highlighted]="i == highlightedIndex" [@highlightAnimation]="i == highlightedIndex">
                {{ i+1 }}. {{ name }}
            </mat-card>
        </div>
    </div>
</div>
<!-- Popup overlay: centered black box, only when showPopup is true -->
<div class="popup-overlay" *ngIf="showPopup">
    <div class="popup-box">
        <div class="popup-line" *ngIf="cellMessage">{{ cellMessage }}</div>
        <div class="popup-line" *ngIf="actionMessage">{{ actionMessage }}</div>
        <div class="popup-line" *ngIf="changesMessage">{{ changesMessage }}</div>
    </div>
</div>
<div class="below-content">
    <div class="table-container mat-elevation-z4">
        <table mat-table [dataSource]="dataSource" class="mat-table modern-table">

            <ng-container matColumnDef="place">
                <th mat-header-cell *matHeaderCellDef> {{placeMessage}} </th>
                <td mat-cell *matCellDef="let team"> {{ team.place }} </td>
            </ng-container>

            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef> {{teamMessage}} </th>
                <td mat-cell *matCellDef="let team"> {{ team.name }} </td>
            </ng-container>

            <ng-container matColumnDef="pointA">
                <th mat-header-cell *matHeaderCellDef> {{shipMessage}} </th>
                <td mat-cell *matCellDef="let team"> {{ team.ship_kill_points }} </td>
            </ng-container>

            <ng-container matColumnDef="pointB">
                <th mat-header-cell *matHeaderCellDef> Палубы </th>
                <td mat-cell *matCellDef="let team"> {{ team.ship_hit_points }} </td>
            </ng-container>

            <ng-container matColumnDef="pointC">
                <th mat-header-cell *matHeaderCellDef> {{answerMessage}} </th>
                <td mat-cell *matCellDef="let team"> {{ team.question_points }} </td>
            </ng-container>

            <ng-container matColumnDef="pointD">
                <th mat-header-cell *matHeaderCellDef> {{bonusMessage}} </th>
                <td mat-cell *matCellDef="let team"> {{ team.bonus_points }} </td>
            </ng-container>

            <ng-container matColumnDef="pointE">
                <th mat-header-cell *matHeaderCellDef> {{penaltyMessage}} </th>
                <td mat-cell *matCellDef="let team"> {{ team.penalty_points }} </td>
            </ng-container>

            <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef> {{totalMessage}} </th>
                <td mat-cell *matCellDef="let team"> {{ team.total }} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        </table>
    </div>
</div>